# Gitチートシート
## Gitのユーザー名とメールアドレスを確認・登録する
### 確認コマンド
```
git config user.name  // ユーザー名
git config user.email  // メールアドレス
```
### 登録コマンド
```
git config --global user.name "Your Name"
git config --global user.email "email@～"
```

## ログを確認するコマンド
```
git log           // commit情報(人や時間の情報が表示される)
git log --oneline // commit一覧のコメントだけ表示する
git log --graph   // commit情報をグラフ上に表示する
```
終了時には`q`を入力する

## コミットを元に戻す方法
### ローカルリポジトリの場合は下記のみでOK
```
git reset --hard HEAD^
```
- `--hard`：コミット取り消した上でワークディレクトリの内容も書き換えたい場合に使用。
- `--soft`：ワークディレクトリの内容はそのままでコミットだけを取り消したい場合に使用。
  - 細かくローカルcommitをしているとこのコマンドは多用するようになる。
- `HEAD^`：直前のコミットを意味する。
- `HEAD~{n}` ：n個前のコミットを意味する。
  - `HEAD^`や`HEAD~{n}`の代わりにコミットのハッシュ値を書いても良い。
  - gitのv1.8.5からは、`HEAD`のエイリアスとして`＠`が用意されている。
    - `HEAD~`と`HEAD^`と`@^`は同じ意味。
    - `HEAD^^^`と`HEAD~3`と`HEAD~~~`と`HEAD~{3}`と`@^^^`は同じ意味。

### 特定のコミットまで戻す
```
git reset --hard コミットのハッシュ値
```

## コミットログを残して上書きする方法
作業ツリーを指定したコミット時点の状態にまで戻し、コミットを行う（コミットをなかったことにはせず、逆向きのコミットをすることで履歴を残す）ためには下記コマンドを叩く。
```
git revert コミットのハッシュ値
```

## コミットの上書きする方法
直前のコミットに上書きするには、下記コマンドを叩く。
```
git commit --amend -m "コミットメッセージ"
```
- コミットメッセージを変更したい時よく使う。
- 「git rebase失敗した時、コンフリクトを避けるためにコミットを上書きする」という使い方もよくする。

## commitせずに変更を待避する【git stash】
　あるブランチで作業中に、別ブランチですぐに変更したい内容があった場合、現在の作業をコミットすることなく待避させる。
**作業を待避する**
```
$ git stash -u
```
　コミットしていない変更がある状態で上記のコマンドを実行すると、変更した部分が退避され、ワーキングディレクトリ上は差分がない状態になる。
　「コミットしていない変更」とは、addしたものもaddしていないものもどちらも含まれる。
　`-u`は`--include-untracked`の略。新規作成ファイル(追跡対象に含まれていないファイル)も退避することができる。

**退避した作業の一覧を見る**
```
$ git stash list
stash@{0}: WIP on test: xxxx
stash@{1}: WIP on commit-sample: xxxx
```
- `stash@{n}`から始まる1行が1回分の`stash`になる。
- `WIP on`のあとはブランチ名。
- `xxxx`は`stash`をしたときのHEADのコミットハッシュとコミットメッセージになる。

**退避した作業を戻す**
```
$ git stash apply stash@{0}
```
- `stash@{0}`の作業をもとに戻す。
- 上記コマンドでは指定しているブランチにスタッシュした作業が戻る。
- スタッシュ名を指定しない場合は直近のスタッシュが戻る。
- 上記コマンドでは`add`していたものも`add`する前の状態で戻る。`add`した状態で戻す場合は下記コマンドを使用する。
```
$ git stash apply stash@{0} --index
```

**待避した作業を戻して消す**
```
$ git stash pop stash@{1}
```

**退避した作業を消す**
- stashを使用して退避した作業を元に戻しても、退避した情報は残ったまま。
- `git stash list`を実行すると、退避した情報はそのまま残っている.そのため、退避した作業を消すには、以下のコマンドを使用する。
```
$ git stash drop stash@{0}
```

**作業を退避するときにメッセージを付ける**
```
$ git stash save "stash message"

$ git stash list
stash@{0}: On test: stash message
```

**退避した変更の詳細をみる**
```
$ git stash show stash@{0}
```
上記コマンドより、変更ファイルの一覧を見ることができる。
また、-pオプションをつけることで、変更内容の詳細をみることもできる。
```
$ git stash show stash@{0} -p
```

**addした変更以外を退避させる**
オプションを何もつけない場合、addした変更もaddしていない変更も退避される(新規追加ファイルは例外)。`-k(もしくは--keep-index)`をつけて実行すると、addした変更は退避されません。
```
$ git stash -k
```

**退避した作業をすべて消す**
```
$ git stash clear
```

### リモートリポジトリにプッシュ済みの場合は上記でローカルを削除したのち下記を実行する。
```
// 強制的にPushする
git push -f origin master
git push origin +master
```

## Git管理下でファイル名の変更する方法：git mvコマンド
```
git mv 変更前ファイル名 変更後ファイル名
```
ファイル名を直接変更した場合は別ファイル扱いになってしまう。だから、ファイル名の変更をGitの差分と認識させるためには上記のコマンドを使用する。

## GitHubのリポジトリの種類変更
1. 変更したいリポジトリ画面を開きSettingボタンを押下する
   1. <img src="Picture/ScreenShot/GitHub%20repositoryの種類変更①.png" width="600">
2. `Danger Zone`の`Change repository visibility`のボタンを押下する
   1. <img src="Picture/ScreenShot/GitHub%20repositoryの種類変更②.png" width="600">
3. 変更したい種類に変更し、リポジトリの名前を記入し決定する
   1. <img src="Picture/ScreenShot/GitHub%20repositoryの種類変更③.png" width="600">

## branch削除
```
git branch -d ブランチ名
git branch --delete ブランチ名
```
- このコマンドではマージ済のブランチを削除できる
  - マージされていなかったり作業中のブランチを削除しようとするとエラーが発生する
  - 下記がエラーメッセージ
```
# 作業中
error: Cannot delete branch '削除するブランチ名' checked out at '作業フォルダパス'
# マージされていない
error: Cannot delete the branch 'ブランチ名' which you are currently on
```
- 作業中のブランチを削除する場合は下記コマンドを使用することでどんなローカルブランチも削除できる
```
git branch -D ブランチ名
```
- 削除したいブランチを選択していると削除できない


## Merge
branchAにbrunchBをmergeする場合のコマンド
branchAを選択した状態で下記コマンドを実行する
```
git merge branchB
```
<img src="Picture/git-merge.png" width="600">

## Squash
Git Squashは複数のコミット履歴を1つのコミット履歴でまとめる時使う。

## パスワード求められたが、パスワードでは対応できない場合
### Mac
1. ターミナルでパスワードを求められる操作を行うと下記のようにパスワードを求められる。ここでコロン以下にGitHubのTokenを入力する。
```
Password for 'https://mht-takayuki-shoji@github.com': Tokenを入力
```

## ブランチ名の変更
```
git branch -m <古いブランチ名> <新しいブランチ名>
```
選択しているブランチの名前を変更する場合
```
git branch -m 新しいブランチ名
```

## Git LFS (Large File Storage)
Gitは大きなファイルやバイナリファイルを扱うのが苦手なので、欠点を補うためにGitHubが開発したのがGit LFS(Large File Storage)という拡張機能。

### インストールとセットアップ
今回の対応ではMacを使用する前提で記載する。
**インストール**
まずはGit LFSクライアントをインストールする。Git LFSはあくまで Gitの拡張機能という位置づけになっている。そのため、利用するにはまず拡張機能を含むソフトウェアを入れる必要がある。

macOS であれば Homebrew を使って`git-lfs`をインストールする。
```
$ brew install git-lfs
```
Git LFSのバージョン確認
```
$ git lfs version

// 実行結果
git-lfs/3.1.2 (GitHub; darwin amd64; go 1.17.6)
```
下記コマンドを実行して Git LFS クライアントの初期設定をする。
```
$ git lfs install

// 実行結果
Git LFS initialized.
```
下記コマンドを実行すると Git クライアントの設定ファイルである `~/.gitconfig`にGit LFS用の設定が入る。
```
$ grep -A 4 lfs ~/.gitconfig

// 実行結果
[filter "lfs"]
	clean = git-lfs clean -- %f
	smudge = git-lfs smudge -- %f
	process = git-lfs filter-process
	required = true
```

## .gitignore
### 基本
Gitによる追跡から特定のファイルを除外するための設定を書き込むファイル。

### 仕様
`.gitignore`に記載された対象ファイルは、`git add`の実行時に、インデックスに追加されないようになる

### 後から変更する方法
すでに追跡してしまっているファイルをGitの追跡対象から除外したい場合は、下記コマンドでインデックスからファイルを削除し、トラッキングを停止することができる
```
# インデックスからのみファイルを削除する（追跡対象からはずす）
git rm --cached <FILE_NAME>
```
インデックス領域を示すオプション「--cached」をつけることで、作業ツリーのファイル実体はそのままで、インデックスからのみファイルを削除できる<br>
`--cached`オプションなしで実行すれば「git rm」は作業ツリー上のファイルの実体と、インデックスの両方を削除する<br>
逆に、もし作業ツリーのファイル実体のみ削除するのであれば、Git でない通常のシェルスクリプト「rm」を使ってファイルを削除することになる

### .gitignoreの書き方

#### 特定のファイルを追跡対象から除外する
- `.gitignore`が置かれたディレクトリの直下のファイルでマッチするものを除外する
- ディレクトリに関係なくマッチする名前のファイルを除外する
```
# どのディレクトリかを問わず、file.phpを除外
file-a.php

# .gitignore が置かれたディレクトリ内のfile.phpを除外
/file-a.php
```
#### 特定のディレクトリを追跡対象から除外する
- 文字列がマッチする特定のディレクトリを除外する
- 文字列がマッチする特定のディレクトリ配下の全てのパスを除外する
```
# 文字列マッチが見つかるパスを除外する
directory-a

# ディレクトリ配下（のすべてのパスを）除外する
directory-a/ 
```
#### ワイルドカードの利用
gitignoreでは、ワイルドカード「*」および「?」が利用できる<br>
「*」は「/（スラッシュ）以外の文字列」、「?」は、「/（スラッシュ）以外の一文字」にマッチする
```
# 「.htaccess」と「.htpasswd」など、.ht で始まるファイルを追跡しない
.ht*

# すべてのファイルを追跡しない
*
```
正規表現でおなじみの「[」「]」を使った文字クラスも利用できる
```
# detail-1.html ~ detail-9.html をマッチ
detail-[1-9].html
```
#### 特定のファイルだけ追跡する
.gitignore では通常は無視するファイルを記載するが、逆に、特定のファイルだけを追跡対象に含めたい場合、ワイルドカード「*」と、同時に否定を表す「！」を行頭に置くと、その行の反対、すなわち「ignoreしない」を設定できる
```
# file-to-track.phpだけを追跡する。
*
!/file-to-trak.php
```
.gitignore では、後に書いた除外設定が、最初に書いた設定内容を上書きするように動作する。ただし、一度記述した「ディレクトリの除外」を、跡から！で追跡しなおす設定は認めらない
```
# ２行目の設定は無効。
/directory/
!/directory/file.html
```
#### 特定のディレクトリ内のファイルだけを追跡する
```
# directory-a のみを追跡
*
!/direcotry-a/
```
#### 特定の拡張子を無視する
```
*.jpg
*.png
```
#### 特定の拡張子を追跡する
```
!*.php
```
#### コメントアウトの書き方
「#」でコメントアウトできる
```
# This is commented out.
```
#### エスケープの仕方
```
/\!important.txt
```

### 参考ツール
- [.gitignore.io](https://www.toptal.com/developers/gitignore)

### サンプル
- [DroidKaigi/conference-app-2022/.gitignore](https://github.com/DroidKaigi/conference-app-2022/blob/main/.gitignore)
  - DroidKaigiのカンファレンスアプリより

## Git用語一覧
| 用語                                  | 意味                                                         | 
| ------------------------------------- | ------------------------------------------------------------ | 
| リポジトリ(repository)                | ファイルやフォルダの履歴を記録する場所                       | 
| ローカルリポジトリ(local repository)  | 自分のPCに作られるリポジトリ                                 | 
| リモートリポジトリ(remote repository) | リモート上のリポジトリ、Git上に作られるリポジトリ            | 
| ベアリポジトリ(bare repository)       | ワークツリーを持たないリポジトリ(↔︎ノンベアリポジトリ)     | 
| ワークツリー(work tree)               | 履歴管理を行うファイルの保存場所                             | 
| インデックス(index)                   | コミットしたいファイルを登録するところ                       | 
| コミット(commit)                      | インデックスに登録した変更内容をローカルリポジトリに反映する | 
| リセット(reset)                       | コミットする前の変更内容をローカルリポジトリの状態へ戻す     | 
| ステージ(stage)                       | ワークツリーからコミットしたいファイルをインデックスに登録   | 
| ハンク(hank)                          | 変更した範囲、変更したひとかたまり                           | 
| ヘッド(head)                          | 作業対象となっているブランチやコミット                       | 
| ブランチ(branch)                      | 履歴管理を分岐させたもの。複数の履歴を並列管理               | 
| チェックアウト(check out)             | 操作対象とするブランチへ切り替える。ヘッドを切り替える       | 
| プッシュ(push)                        | ローカルリポジトリの変更をリモートリポジトリに反映           | 
| プル(pull)                            | リモートリポジトリの変更をローカルリポジトリに反映           | 
| マージ(marge)                         | 異なるブランチの変更を反映(相互の変更履歴が残る)             | 
| リベース(rebase)                      | 異なるブランチの変更を反映(変更履歴が片方に集約)             | 
| コンフリクト(conflict)                | 複数人が同じファイルの同じ場所を変更した時に起こるエラー     | 
| フォーク(fork)                        | リモートリポジトリをコピーしてリモートリポジトリを作成       | 
| クローン(clone)                       | リモートリポジトリをコピーしてローカルリポジトリを作成       | 
| .gitignore                            | 履歴管理の対象外のファイルを登録するファイル                 | 
